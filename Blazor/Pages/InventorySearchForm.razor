@using Blazor.Models

<div id="sidebar">
    <EditForm Model="@_searchModel" OnValidSubmit="@OnSubmit">
        <DataAnnotationsValidator />
        <div class="search-container">
                <input type="text" class="text-field" placeholder="Enter ID" @bind="_searchModel.Id"/>
                <input type="text" class="text-field" placeholder="Enter title" @bind="_searchModel.MediaTitle"/>
                <select class="text-field" @bind="_searchModel.Branch">
                    <option value="">All Branches</option>
                    @foreach (var branch in BranchList)
                    {
                        <option value="@branch.ObjectID">@branch.Name</option>
                    }
                </select>
            <button type="submit" class="search-button"><svg class="search-icon" fill="#FAFAF9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg><span>Search</span></button>
        </div>
        <ValidationSummary />
    </EditForm>
</div>

@code { 
    [Parameter] 
    public EventCallback<List<Filter>> OnSubmitCallback { get; set; } 
    
    private InventorySearchModel _searchModel = new InventorySearchModel(); 
    private List<Filter> _searchFilters = new List<Filter>(); 
    
    [Parameter]
    public List<Entities.Branch> BranchList { get; set; } = new();
    
    public async Task OnSubmit() { 
        FormatSearchFilters(_searchModel); 
        await OnSubmitCallback.InvokeAsync(_searchFilters); 
    } 
    private void FormatSearchFilters(InventorySearchModel model) 
    {
        _searchFilters.Clear();
        if (!string.IsNullOrEmpty(model.Id))
        {
            _searchFilters.Add(new Filter("_id", model.Id, FilterTypes.Equals));
        }

        if (!string.IsNullOrEmpty(model.MediaTitle))
        {
            _searchFilters.Add(new Filter("title", model.MediaTitle, FilterTypes.Contains));
        }

        if (!string.IsNullOrEmpty(model.Branch))
        {
            _searchFilters.Add(new Filter("branch", model.Branch, FilterTypes.Equals));
        } 
    }

}