@page "/"
@inject HttpClient HttpClient

<PageTitle>Home</PageTitle>

<MediaSearchForm OnSubmitCallback="MakeSearch" />
@foreach (var doc in bsonDocs)
{
    <SearchResultListComponent resultString="@doc"></SearchResultListComponent>
}

@if (test)
{
    <div>@test</div>
}


@code {
    private List<string> bsonDocs = new();
    private bool test = false;

    protected override async Task OnInitializedAsync()
    {
        await GetMedia();
    }

    private async Task GetMedia()
    {
        var response = await HttpClient.GetFromJsonAsync<SearchResponse>("api/mediaSearch");
        if (response != null && response.Results != null)
        {
            bsonDocs = response.Results;
        }
    }

    private async Task GetSearchResults(List<Filter> filters)
    {
        var response = await HttpClient.PostAsJsonAsync("api/mediaSearch", filters);
        if (response.IsSuccessStatusCode)
        {
            var searchResponse = await response.Content.ReadFromJsonAsync<SearchResponse>();
            if (searchResponse != null)
            {
                bsonDocs = searchResponse.Results;
            }
        }
        StateHasChanged();
    }
    private void MakeSearch(List<Filter> filters)
    {
        GetSearchResults(filters);
    }
}