
@namespace Blazor.Layout
@inject ISessionStorageService SessionStorage
@inject AuthStateService AuthState

<nav class="navbar">
    <div class="nav-left">
        <a class="home">AML</a>
    </div>
    <div class="nav-right">
        
        @switch (userRole)
        {
            case "SystemAdmin":
                <div>admin</div>
                break;
            case "BranchManager":
                <div>admin</div>
                break;
            case "BranchLibrarian":
                <div>admin</div>
                break;
            case "Member":
                <div>admin</div>
                break;
            default:
                <div>not signed in</div>
                break;
        }
    </div>
</nav>

@code {
    private string? email;
    private string? userRole;
    private ClaimsPrincipal? currentUser;

    protected override async Task OnInitializedAsync()
    {
        currentUser = await AuthState.GetUser();
        await UpdateUserInfo();

        AuthState.OnChange += OnAuthStateChanged;
    }

    private async Task UpdateUserInfo()
    {
        if (currentUser != null)
        {
            email = currentUser.FindFirst(ClaimTypes.Email)?.Value;
            userRole = currentUser.FindFirst(ClaimTypes.Role)?.Value;
        }
        else
        {
            email = null;
            userRole = null;
        }
    }

    private async void OnAuthStateChanged()
    {
        currentUser = await AuthState.GetUser();
        await UpdateUserInfo();
        StateHasChanged();
    }

}